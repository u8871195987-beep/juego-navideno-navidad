<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ Juego NavideÃ±o: Juguetes del Duende LadrÃ³n ğŸ</title>
    <link href="https://fonts.googleapis.com/css2?family=Festive:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 20px; background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 50%, #FFFFFF 100%); font-family: 'Festive', cursive, Arial, sans-serif; color: #333; text-align: center; min-height: 100vh; }
        #container { max-width: 800px; margin: auto; }
        #map { display: flex; justify-content: space-around; margin: 30px 0; flex-wrap: wrap; }
        .station { flex: 1 1 150px; padding: 20px; margin: 10px; border: 4px solid #ddd; border-radius: 25px; background: linear-gradient(white, #f0f8ff); cursor: pointer; transition: all 0.3s; font-size: 1.2em; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .station:hover { transform: scale(1.05); }
        .station.unlocked { border-color: #4CAF50; background: #E8F5E8; }
        .station.current { border-color: #FFD700; background: linear-gradient(#FFD700, #FFA500); box-shadow: 0 0 30px #FFD700; animation: pulse 1s infinite; }
        @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.1);} }
        #content { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); min-height: 450px; }
        h1, h2 { color: #C41E3A; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        button { background: linear-gradient(#FF6B35, #F7931E); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1em; cursor: pointer; margin: 10px; font-family: inherit; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
        button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        input { padding: 15px; font-size: 1.1em; border: 3px solid #ddd; border-radius: 15px; width: 350px; max-width: 90%; box-sizing: border-box; }
        .paywall { text-align: center; }
        .paywall hr { border: none; height: 3px; background: linear-gradient(#ddd, transparent); margin: 40px 0; }
        .paywall label { display: block; margin: 25px 0 15px; font-weight: bold; font-size: 1.2em; }
        @media (max-width: 600px) { #map { flex-direction: column; } .station { margin: 10px 0; } }
    </style>
</head>
<body>
    <div id="container">
        <h1>ğŸ„ Â¡Juguetes del Duende LadrÃ³n! ğŸ</h1>
        <p>Â¡Ayuda a fabricar, recuperar y entregar regalos para salvar la Navidad! Ho ho ho... ğŸ˜ˆ</p>
        <div id="map">
            <div class="station" data-lvl="0">ğŸš€ Inicio</div>
            <div class="station" data-lvl="1">ğŸ­ FÃ¡brica</div>
            <div class="station" data-lvl="2">ğŸŒ² Bosque</div>
            <div class="station" data-lvl="3">ğŸ  Casa Noel ğŸ…</div>
        </div>
        <div id="content"></div>
        <footer style="margin-top:30px; font-size:0.8em; color:#666;">Creado con â¤ï¸ para Navidad 2025 | Pagos seguros via Gumroad</footer>
    </div>
    <script>
        const GUMROAD_PRODUCTS = {
            1: { name: 'ğŸ­ FÃ¡brica de Juguetes', id: 'REPLACE_FABRICA_ID_AQUI', buyUrl: 'https://tunombre.gumroad.com/l/reemplaza_slug_fabrica' },
            2: { name: 'ğŸŒ² Bosque Encantado', id: 'REPLACE_BOSQUE_ID_AQUI', buyUrl: 'https://tunombre.gumroad.com/l/reemplaza_slug_bosque' },
            3: { name: 'ğŸ  Casa de PapÃ¡ Noel', id: 'REPLACE_CASA_ID_AQUI', buyUrl: 'https://tunombre.gumroad.com/l/reemplaza_slug_casa' }
        };

        let gameState = JSON.parse(localStorage.getItem('duendeGame') || '{"level":0}');
        let currentPaywallLevel = 0;

        function save() { localStorage.setItem('duendeGame', JSON.stringify(gameState)); }

        function render() {
            const content = document.getElementById('content');
            const stations = document.querySelectorAll('.station');
            stations.forEach(s => {
                const lvl = parseInt(s.dataset.lvl);
                s.classList.toggle('unlocked', lvl <= gameState.level);
                s.classList.toggle('current', lvl === gameState.level);
                s.onclick = () => { if (lvl <= gameState.level) { gameState.level = lvl; save(); render(); } };
            });

            if (gameState.level === 0) {
                content.innerHTML = `<h2>Â¡Bienvenido, elfo ayudante! ğŸ…</h2><p>En la fÃ¡brica creas regalos, pero un duende los roba al bosque. Â¡RecupÃ©ralos!</p><button onclick="showPaywall(1)">ğŸ’³ Desbloquear FÃ¡brica (5â‚¬)</button>`;
            } else if (gameState.level === 1) {
                if (!gameState.toy) {
                    content.innerHTML = `<h2>ğŸ­ Â¡FÃ¡brica de Juguetes!</h2><p>Elige quÃ© fabricar con magia navideÃ±a:</p><button onclick="chooseToy('muÃ±eca')">ğŸ‘§ MuÃ±eca para niÃ±a soÃ±adora</button><button onclick="chooseToy('tren')">ğŸš‚ Tren para niÃ±o aventurero</button><button onclick="chooseToy('bici')">ğŸš² Bici para exploradora</button>`;
                } else {
                    content.innerHTML = `<h2>Â¡${gameState.toy.charAt(0).toUpperCase() + gameState.toy.slice(1)} lista! ğŸ‰</h2><p>Â¡Oh no! ğŸ˜ˆ Un duende la roba y huye al bosque riendo...</p><button onclick="showPaywall(2)">ğŸŒ² Â¡Al Bosque! (5â‚¬)</button>`;
                }
            } else if (gameState.level === 2) {
                if (!gameState.path) {
                    content.innerHTML = `<h2>ğŸŒ² Â¡Bosque Nevado!</h2><p>Nieve por todos lados... Elige camino:</p><button onclick="choosePath('izq')">â„ï¸ Izquierda: huellas frescas</button><button onclick="choosePath('der')">ğŸŒŸ Derecha: luces mÃ¡gicas</button><button onclick="choosePath('cen')">ğŸ‘» Centro: risas malvadas</button>`;
                } else if (!gameState.dialogue) {
                    content.innerHTML = `<h2>ğŸ˜ˆ Â¡Duende encontrado!</h2><p>Lo pillas con tu ${gameState.toy}. Â¡Elige diÃ¡logo!</p><button onclick="chooseDialogue('agresivo')">âš¡ "Â¡DevuÃ©lvelo o te denuncia PapÃ¡ Noel!"</button><button onclick="chooseDialogue('amigable')">ğŸª "Â¿Galletas por el juguete?"</button><button onclick="chooseDialogue('persecucion')">ğŸƒ "Â¡Te pillarÃ©, no escaparÃ¡s!"</button>`;
                } else {
                    const outcomes = {agresivo: 'Se asusta y te lo da temblando. ğŸ˜±', amigable: 'Â¡Acepta galletas feliz! ğŸ˜Š', persecucion: 'Se agota corriendo y se rinde. ğŸ'};
                    content.innerHTML = `<h2>ğŸ‰ Â¡Juguete recuperado!</h2><p>${outcomes[gameState.dialogue]}</p><button onclick="showPaywall(3)">ğŸ  Â¡A Casa Noel! (5â‚¬)</button>`;
                }
            } else if (gameState.level === 3) {
                if (!gameState.kid) {
                    content.innerHTML = `<h2>ğŸ  Â¡Casa de PapÃ¡ Noel! ğŸ…</h2><p>"Â¡Gracias, elfo! Entrega la ${gameState.toy}:"</p><button onclick="chooseKid('ana')">ğŸ‘§ Ana (ama muÃ±ecas)</button><button onclick="chooseKid('pedro')">ğŸš‚ Pedro (ama trenes)</button><button onclick="chooseKid('maria')">ğŸš² MarÃ­a (ama bicis)</button>`;
                } else {
                    const matches = {muÃ±eca: 'ana', tren: 'pedro', bici: 'maria'};
                    const isPerfect = matches[gameState.toy] === gameState.kid;
                    content.innerHTML = `<h2>âœ¨ Â¡Navidad Salvada! ğŸ„</h2><p>Â¡${gameState.kid.charAt(0).toUpperCase() + gameState.kid.slice(1)} recibe la ${gameState.toy}! ğŸ</p><p>${isPerfect ? 'Â¡Match perfecto! LÃ¡grimas de alegrÃ­a eterna. â­â­â­' : 'Â¡SÃºper feliz! â­â­'}</p><button onclick="resetGame()">ğŸ”„ Jugar de Nuevo</button>`;
                }
            }
        }

        function chooseToy(toy) { gameState.toy = toy; save(); render(); }
        function choosePath(path) { gameState.path = path; save(); render(); }
        function chooseDialogue(dlg) { gameState.dialogue = dlg; save(); render(); }
        function chooseKid(kid) { gameState.kid = kid; save(); render(); }

        function showPaywall(nextLevel) {
            currentPaywallLevel = nextLevel;
            const product = GUMROAD_PRODUCTS[nextLevel];
            document.getElementById('content').innerHTML = `
                <div class="paywall">
                    <h2>ğŸ’³ Desbloquear ${product.name} - 5â‚¬</h2>
                    <a href="${product.buyUrl}" target="_blank" rel="noopener noreferrer" style="display:inline-block; padding:15px 30px; background:#4CAF50; color:white; text-decoration:none; border-radius:25px; font-size:1.2em; margin:10px;">ğŸ›’ Comprar Ahora</a>
                    <p style="font-size:0.9em; color:#666;">(Nueva pestaÃ±a. Clave por email en segundos âœ…)</p>
                    <hr>
                    <label>ğŸ“§ Pega tu clave:</label>
                    <input type="text" id="licenseKey" placeholder="ej: ABCD1234-EFGH5678-IJKL9012" autofocus>
                    <br><button onclick="verifyKey()">âœ… Verificar & Desbloquear</button>
                    <p id="msg" style="font-weight:bold;"></p>
                    <br><button onclick="render()">â† AtrÃ¡s</button>
                </div>`;
        }

        function verifyKey() {
            const key = document.getElementById('licenseKey').value.trim();
            const msgEl = document.getElementById('msg');
            const product = GUMROAD_PRODUCTS[currentPaywallLevel];
            if (!key) return msgEl.textContent = 'Â¡Ingresa la clave!'; msgEl.style.color = 'red';
            msgEl.textContent = 'Verificando... â³'; msgEl.style.color = 'blue';

            const formData = new URLSearchParams();
            formData.append('product_id', product.id);
            formData.append('license_key', key);

            fetch('https://api.gumroad.com/v2/licenses/verify', {
                method: 'POST',
                body: formData,
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    msgEl.style.color = 'green';
                    msgEl.textContent = 'Â¡Desbloqueado! ğŸ‰';
                    gameState.level = currentPaywallLevel;
                    save();
                    setTimeout(render, 1500);
                } else {
                    msgEl.style.color = 'red';
                    msgEl.textContent = 'Clave invÃ¡lida/usos agotados. ğŸ˜”';
                }
            })
            .catch(() => { msgEl.style.color = 'red'; msgEl.textContent = 'Error conexiÃ³n. Reintenta.'; });
        }

        function resetGame() {
            if (confirm('Â¿Resetear progreso? PerderÃ¡s desbloqueos. ğŸ˜¢')) {
                localStorage.removeItem('duendeGame');
                gameState = {level: 0};
                render();
            }
        }

        render();
    </script>
</body>
</html>
